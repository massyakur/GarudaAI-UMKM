# GarudaAI UMKM API

API for UMKM Management System menggunakan FastAPI dan SQLite.

## Installation

```bash
# Install dependencies using uv
uv sync
```

## Database Setup

Generate sample data untuk database SQLite:

```bash
python generate_data.py
```

Script ini akan:
- Membuat database SQLite (`garudaai_umkm.db`)
- Generate 20 users (termasuk admin dan test user)
- Generate 50 UMKM businesses dengan data random
- Generate ~400 products untuk semua UMKM
- Generate ~200 customers untuk semua UMKM
- Generate ~500 transactions dengan detail items

## Running the Application

```bash
# Using Python directly
python main.py

# Or using uvicorn
uvicorn main:app --reload
```

Server akan berjalan di `http://localhost:8000`

## API Documentation

Dokumentasi interaktif tersedia di:
- Swagger UI: `http://localhost:8000/docs`
- ReDoc: `http://localhost:8000/redoc`

## Endpoints

Semua endpoints menggunakan prefix `/api/v1/`

### Authentication
- `POST /api/v1/login` - Login user

### Products
- `POST /api/v1/products` - Create product
- `GET /api/v1/products` - Get all products (with filters: umkm_id, category, is_active)
- `GET /api/v1/products/{id}` - Get product by ID
- `PUT /api/v1/products/{id}` - Update product
- `DELETE /api/v1/products/{id}` - Delete product

### Customers
- `POST /api/v1/customers` - Create customer
- `GET /api/v1/customers` - Get all customers (with filters: umkm_id, search)
- `GET /api/v1/customers/{id}` - Get customer by ID
- `PUT /api/v1/customers/{id}` - Update customer
- `DELETE /api/v1/customers/{id}` - Delete customer

### Transactions
- `POST /api/v1/transactions` - Create transaction (with items)
- `GET /api/v1/transactions` - Get all transactions (with filters: umkm_id, payment_status, date range)
- `GET /api/v1/transactions/{id}` - Get transaction by ID
- `PUT /api/v1/transactions/{id}` - Update transaction
- `DELETE /api/v1/transactions/{id}` - Delete transaction (restore stock)

### Analytics & Reports
- `GET /api/v1/analytics/dashboard` - Dashboard summary (revenue, growth, top products, dll)
- `GET /api/v1/analytics/sales-report` - Laporan penjualan (revenue, profit, rata-rata transaksi)
- `GET /api/v1/analytics/top-products` - Produk terlaris
- `GET /api/v1/analytics/monthly-report` - Laporan bulanan
- `GET /api/v1/analytics/payment-methods` - Statistik metode pembayaran

### Example: Create Transaction

**Request Body:**
```json
{
  "umkm_id": 1,
  "customer_id": 1,
  "customer_name": "John Doe",
  "transaction_type": "sale",
  "payment_method": "cash",
  "discount_amount": 5000,
  "tax_amount": 10000,
  "payment_status": "paid",
  "notes": "Pembelian reguler",
  "items": [
    {
      "product_id": 1,
      "quantity": 2,
      "unit_price": 50000,
      "discount": 0
    },
    {
      "product_id": 2,
      "quantity": 1,
      "unit_price": 75000,
      "discount": 5000
    }
  ]
}
```

## Test Credentials

Setelah menjalankan `generate_data.py`, gunakan credentials berikut:

**Admin Account:**
- Email: `admin@garudaai.com`
- Password: `admin123`

**User Account:**
- Email: `user@example.com`
- Password: `secret`

**Random Users:**
- Email: (generated by Faker)
- Password: `password123`

## Project Structure

```
.
├── app/
│   ├── __init__.py
│   ├── core/
│   │   ├── __init__.py
│   │   ├── database.py      # SQLite configuration
│   │   └── security.py      # JWT & password utilities
│   ├── models/
│   │   ├── __init__.py
│   │   ├── user.py          # User model
│   │   ├── umkm.py          # UMKM model
│   │   ├── product.py       # Product model
│   │   ├── customer.py      # Customer model
│   │   └── transaction.py   # Transaction & TransactionItem models
│   ├── routers/
│   │   ├── __init__.py
│   │   ├── auth.py          # Authentication endpoints
│   │   ├── products.py      # Products CRUD endpoints
│   │   ├── customers.py     # Customers CRUD endpoints
│   │   └── transactions.py  # Transactions CRUD endpoints
│   └── schemas/
│       ├── __init__.py
│       ├── auth.py          # Auth Pydantic models
│       ├── product.py       # Product Pydantic models
│       ├── customer.py      # Customer Pydantic models
│       └── transaction.py   # Transaction Pydantic models
├── generate_data.py         # Database seeder script
├── main.py                  # FastAPI application
└── pyproject.toml          # Project dependencies
```

## Database Schema

### Users Table
- `id` (Primary Key)
- `email` (Unique)
- `name`
- `hashed_password`
- `phone`
- `role` (user, manager, admin)
- `is_active`
- `created_at`
- `updated_at`

### UMKM Table
- `id` (Primary Key)
- `owner_id` (Foreign Key -> users.id)
- `business_name`
- `business_type`
- `description`
- `address`
- `phone`
- `email`
- `established_year`
- `employee_count`
- `monthly_revenue`
- `created_at`
- `updated_at`

### Products Table
- `id` (Primary Key)
- `umkm_id` (Foreign Key -> umkm.id)
- `name`
- `description`
- `category`
- `price`
- `stock`
- `unit` (pcs, kg, liter, porsi, pack)
- `sku` (Stock Keeping Unit)
- `is_active`
- `created_at`
- `updated_at`

### Customers Table
- `id` (Primary Key)
- `umkm_id` (Foreign Key -> umkm.id)
- `name`
- `phone`
- `created_at`
- `updated_at`

### Transactions Table
- `id` (Primary Key)
- `umkm_id` (Foreign Key -> umkm.id)
- `transaction_number` (Auto-generated: TRX-{umkm_id}-{date}-{seq})
- `transaction_date`
- `customer_id` (Foreign Key -> customers.id, nullable)
- `customer_name` (For walk-in customers)
- `transaction_type` (sale, purchase, return)
- `payment_method` (cash, transfer, e_wallet, credit)
- `total_amount`
- `discount_amount`
- `tax_amount`
- `final_amount`
- `payment_status` (pending, paid, partial, cancelled)
- `notes`
- `created_by` (Foreign Key -> users.id)
- `created_at`
- `updated_at`

### Transaction Items Table
- `id` (Primary Key)
- `transaction_id` (Foreign Key -> transactions.id)
- `product_id` (Foreign Key -> products.id)
- `product_name` (Snapshot)
- `quantity`
- `unit_price`
- `discount`
- `subtotal`
- `created_at`

## Features

### Transaction Management
- Auto-generate transaction numbers (TRX-{umkm_id}-{date}-{seq})
- Support multiple items per transaction
- Auto-calculate totals (subtotal, discount, tax, final amount)
- Auto-update product stock when creating/deleting transactions
- Filter by UMKM, payment status, and date range

### Product Management
- Track stock levels
- Support multiple units (pcs, kg, liter, porsi, pack)
- Category management
- SKU for inventory tracking
- Active/inactive status

### Customer Management
- Simple customer data (name + phone)
- Search by name or phone
- Per-UMKM customer database

## Next Steps

- Implementasi authentication middleware untuk protected routes
- Tambahkan endpoint register
- Implementasi refresh token
- Tambahkan role-based access control (owner hanya bisa akses UMKM miliknya)
- Tambahkan CRUD endpoints untuk UMKM
- Implementasi reporting & analytics (revenue, top products, etc)
- Export transactions to PDF/Excel